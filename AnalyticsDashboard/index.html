<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteWall Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent: #58a6ff;
            --border: #30363d;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1, h2 {
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 20px;
        }
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .metric-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
        }
        .metric-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>NoteWall Analytics Dashboard</h1>
        <p>Data Range: 2026/01/02 - 2026/01/29</p>

        <!-- Key Metrics Row -->
        <div class="metric-grid">
            <div class="metric-card">
                <div class="metric-value">195</div>
                <div class="metric-label">Onboarding Starts</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">69</div>
                <div class="metric-label">Onboarding Completes</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">35.4%</div>
                <div class="metric-label">Completion Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">29</div>
                <div class="metric-label">Purchases</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- Funnel Chart -->
            <div class="card">
                <h2>Onboarding Funnel (User Drop-off)</h2>
                <div class="chart-container">
                    <canvas id="funnelChart"></canvas>
                </div>
                <p style="color: var(--text-secondary); font-size: 12px; margin-top: 10px;">
                    Shows unique active users per screen/stage.
                </p>
            </div>

            <!-- Retention Chart -->
            <div class="card">
                <h2>User Retention (Daily)</h2>
                <div class="chart-container">
                    <canvas id="retentionChart"></canvas>
                </div>
            </div>
            
            <!-- Engagement Chart -->
            <div class="card">
                <h2>Screen Views Breakdown</h2>
                <div class="chart-container">
                    <canvas id="viewsChart"></canvas>
                </div>
            </div>

            <!-- Conversion Pie -->
            <div class="card">
                <h2>Conversion Overview</h2>
                <div class="chart-container">
                    <canvas id="conversionChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Data from provided CSVs ---
        
        // Funnel Data (From Pages_and_screens*.csv and Events*.csv)
        // Ordered logically by volume/expected flow
        const funnelData = {
            labels: [
                'Start', 
                'Quiz (Start)', 
                'Results Preview', 
                'Setup Intro', 
                'Pain Point', 
                'Social Proof', 
                'Setup Complete', 
                'Purchase Success'
            ],
            data: [
                195, // onboarding_start (Events)
                181, // onboarding_multi_quiz_But before we start (Pages)
                178, // onboarding_results_preview (Pages)
                172, // onboarding_setup_intro (Pages)
                126, // onboarding_pain_point (Pages) - Significant Drop?
                121, // onboarding_social_proof (Pages)
                103, // onboarding_setup_complete (Pages)
                29   // purchase_success (Events)
            ]
        };

        // Calculate drop-off percentages for tooltip
        const funnelPercentages = funnelData.data.map(val => ((val / funnelData.data[0]) * 100).toFixed(1) + '%');

        // Retention Data (From View_user_engagement*.csv)
        // Day 0 to 6
        const retentionData = {
            labels: ['Day 0', 'Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6'],
            data: [16, 13, 14, 14, 14, 6, 10]
        };

        // Top Screen Views (Pages_and_screens*.csv)
        const viewsData = {
            labels: [
                'Setup Intro',
                'Setup Complete',
                'Quiz Intro',
                'Multi Quiz',
                'Pain Point',
                'Social Proof',
                'Results Preview'
            ],
            data: [247, 146, 283, 270, 191, 183, 267]
        };


        // --- Chart Configuration ---

        Chart.defaults.color = '#8b949e';
        Chart.defaults.borderColor = '#30363d';

        // 1. Funnel Chart
        new Chart(document.getElementById('funnelChart'), {
            type: 'bar',
            data: {
                labels: funnelData.labels,
                datasets: [{
                    label: 'Active Users',
                    data: funnelData.data,
                    backgroundColor: funnelData.data.map((_, i) => i === 0 ? '#58a6ff' : (i === funnelData.data.length - 1 ? '#2ea043' : '#1f6feb')),
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y', // Horizontal bars for funnel
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.raw + ' Users (' + funnelPercentages[context.dataIndex] + ' of Start)';
                            }
                        }
                    }
                },
                scales: {
                    x: { beginAtZero: true }
                }
            }
        });

        // 2. Retention Chart
        new Chart(document.getElementById('retentionChart'), {
            type: 'line',
            data: {
                labels: retentionData.labels,
                datasets: [{
                    label: 'Active Users Retained',
                    data: retentionData.data,
                    borderColor: '#a371f7',
                    backgroundColor: 'rgba(163, 113, 247, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 3. Views Chart
        new Chart(document.getElementById('viewsChart'), {
            type: 'bar',
            data: {
                labels: viewsData.labels,
                datasets: [{
                    label: 'Total Views',
                    data: viewsData.data,
                    backgroundColor: '#d29922',
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                }
            }
        });

        // 4. Conversion Pie
        new Chart(document.getElementById('conversionChart'), {
            type: 'doughnut',
            data: {
                labels: ['Dropped Off', 'Completed (No Purchase)', 'Purchased'],
                datasets: [{
                    data: [
                        195 - 69, // Started but didn't complete
                        69 - 29,  // Completed but didn't buy
                        29        // Bought
                    ],
                    backgroundColor: [
                        '#da3633', // Red
                        '#8b949e', // Grey
                        '#2ea043'  // Green
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' }
                }
            }
        });

    </script>
</body>
</html>
